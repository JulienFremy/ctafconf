#!/bin/sh
## xsession for xsession in /home/ctaf/.ctafconf/etc/xsession
##
## Made by GESTES Cedric
## Login   <ctaf@epita.fr>
##
## Started on  Mon Sep 26 02:37:56 2005 GESTES Cedric
## Last update Tue Apr 11 20:13:16 2006 GESTES Cedric
##
##CTAFCONF

#refuse all connection to xserver except for localhost
xhost -
xhost +localhost

#merge setting for x application (xterm,aterm,..)
xrdb -merge ~/.ctafconf/etc/xsession/Xdefaults

if [ -f ~/.ctafconf/perso/user-profile ] ; then
    . ~/.ctafconf/perso/user-profile
fi

if [ x$ctafconf_wm = xterm ]; then
    #appel bloquant
    exec ~/.ctafconf/bin/ct-launch term
fi

if [ x$ctafconf_wm != xgnome && x$ctafconf_wm != xe16 ] ; then
#set the wallpaper
    ~/.ctafconf/bin/ct-set-bg
fi

#personal startup file
if [ -f ~/.ctafconf/perso/xsession.mine ]; then
    source ~/.ctafconf/perso/xsession.mine
fi

########################### LAUNCHING WM ###########################
#Lauch gnome (appel bloquant)
if [ x$ctafconf_wm = xgnome ]; then
  if which gnome-session >/dev/null 2>/dev/null; then
    exec gnome-session
  fi
else
#launch the gnome setting daemon (for font, gconf, ...) after gnome-session
#cause gnome-session launch it
  if which gnome-settings-daemon >/dev/null 2>/dev/null; then
    gnome-settings-daemon&
  fi
fi


#lauch kde
if [ x$ctafconf_wm = xkde ]; then
    if which startkde >/dev/null 2>/dev/null; then
    exec startkde
    fi
fi

#lauch xfce4
if [ x$ctafconf_wm = xxfce4 ]; then
  if which startxfce4 >/dev/null 2>/dev/null; then
    exec startxfce4
  fi
fi


#fluxbox
if [ x$ctafconf_wm = xfluxbox ]; then
  if which startfluxbox >/dev/null 2>/dev/null; then
    exec startfluxbox
  fi
fi

#Enlightenment 16
if [ x$ctafconf_wm = xe16 ]; then
    if which enlightenment >/dev/null 2>/dev/null; then
        exec starte16
    fi
fi

#anothers wm
if which $ctafconf_wm >/dev/null 2>/dev/null ; then
    exec $ctafconf_wm
fi

#term
exec ~/.ctafconf/bin/ct-launch term

# curr_wm=$ctafconf_wm
# echo $ctafconf_wm >~/.ctafconf/current_wm

# while ; do
#     if ! [ x`cat ~/.ctafconf/current_wm` = x$curr_wm ]; then
#         xterm
#         sleep 2
#     fi
# done
