#!/bin/sh
## xsession for xsession in /home/ctaf/.ctafconf/etc/xsession
##
## Made by GESTES Cedric
## Login   <ctaf@epita.fr>
##
## Started on  Mon Sep 26 02:37:56 2005 GESTES Cedric
## Last update Mon May 15 01:55:56 2006 GESTES Cedric
##
##CTAFCONF

#test_wm
#launch_app add app to launch list
#launch_wm
#don't relaunch a wm before, the loop (protect with one var)



mv ~/.ctafconf/perso/ctafconf.log ~/.ctafconf/perso/ctafconf.log.1

. ~/.ctafconf/etc/shlib/xsession.sh

#refuse all connection to xserver except for localhost
xhost -
xhost +localhost

#merge setting for x application (xterm,aterm,..)
xrdb -merge ~/.ctafconf/etc/xsession/Xdefaults

if [ -f ~/.ctafconf/perso/user-profile ] ; then
  . ~/.ctafconf/perso/user-profile
fi

#if ! test_wm e16 ; then
#fi
#set the wallpaper
launch_app ~/.ctafconf/bin/ct-set-bg


if test_wm term ; then
  #appel bloquant
  ct_log TERM WM
  launch_wm
fi

#personal startup file
if [ -f ~/.ctafconf/perso/xsession.mine ]; then
  source ~/.ctafconf/perso/xsession.mine
fi

########################### LAUNCHING WM ###########################
#Lauch gnome (appel bloquant)
if ! test_wm gnome ; then
  #launch the gnome setting daemon (for font, gconf, ...) after gnome-session
  #cause gnome-session launch it
  if which gnome-settings-daemon >/dev/null 2>/dev/null; then
    launch_app gnome-settings-daemon
  fi
fi

#lauch the window manager
launch_wm
