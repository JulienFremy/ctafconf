#!/bin/sh
## xsession for xsession in /home/ctaf/.ctafconf/etc/xsession
##
## Made by GESTES Cedric
## Login   <ctaf@epita.fr>
##
## Started on  Mon Sep 26 02:37:56 2005 GESTES Cedric
## Last update Sat Apr 22 21:05:39 2006 GESTES Cedric
##
##CTAFCONF

#test_wm
#launch_app add app to launch list
#launch_wm

. ~/.ctafconf/etc/shlib/xsession.sh

#refuse all connection to xserver except for localhost
xhost -
xhost +localhost

#merge setting for x application (xterm,aterm,..)
xrdb -merge ~/.ctafconf/etc/xsession/Xdefaults

if [ -f ~/.ctafconf/perso/user-profile ] ; then
  . ~/.ctafconf/perso/user-profile
fi

if test_wm term ; then
  #appel bloquant
  launch_wm ~/.ctafconf/bin/ct-launch term
fi

if test_wm e16 ; then
  #set the wallpaper
  ~/.ctafconf/bin/ct-set-bg
fi

#personal startup file
if [ -f ~/.ctafconf/perso/xsession.mine ]; then
  source ~/.ctafconf/perso/xsession.mine
fi

########################### LAUNCHING WM ###########################
#Lauch gnome (appel bloquant)
if test_wm gnome ; then
  if which gnome-session >/dev/null 2>/dev/null; then
    launch_wm gnome-session
  fi
else
  #launch the gnome setting daemon (for font, gconf, ...) after gnome-session
  #cause gnome-session launch it
  if which gnome-settings-daemon >/dev/null 2>/dev/null; then
    launch_app gnome-settings-daemon
  fi
fi


#lauch kde
if test_wm kde ; then
    if which startkde >/dev/null 2>/dev/null; then
    launch_wm startkde
    fi
fi

#lauch xfce4
if test_wm xfce4 ; then
  if which startxfce4 >/dev/null 2>/dev/null; then
    launch_wm startxfce4
  fi
fi


#fluxbox
if test_wm fluxbox ; then
  if which startfluxbox >/dev/null 2>/dev/null; then
    launch_wm startfluxbox
  fi
fi

#Enlightenment 16
if test_wm e16 ; then
  if which enlightenment >/dev/null 2>/dev/null; then
    launch_wm starte16
  fi
fi

#anothers wm
if which $ctafconf_wm >/dev/null 2>/dev/null ; then
  launch_wm $ctafconf_wm
fi

#term
launch_wm ~/.ctafconf/bin/ct-launch term

# curr_wm=$ctafconf_wm
# echo $ctafconf_wm >~/.ctafconf/current_wm

# while ; do
#     if ! [ x`cat ~/.ctafconf/current_wm` = x$curr_wm ]; then
#         xterm
#         sleep 2
#     fi
# done
