#!/bin/sh
##
## ct-install.sh
## Login : <ctaf@localhost.localdomain>
## Started on  Tue Apr 11 13:55:03 2006 GESTES Cedric
## $Id$
##
## Copyright (C) 2006 GESTES Cedric
## This program is free software; you can redistribute it and/or modify
## it under the terms of the GNU General Public License as published by
## the Free Software Foundation; either version 2 of the License, or
## (at your option) any later version.
##
## This program is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
## GNU General Public License for more details.
##
## You should have received a copy of the GNU General Public License
## along with this program; if not, write to the Free Software
## Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
##

pkg_description()
{
    local name=$1

    eval $name"_description"
    return $?
}

pkg_is_installed()
{
    local name=$1

    eval $name"_is_installed"
    return $?
}

pkg_install()
{
    local name=$1

    eval $name"_install"
    return $?
}

pkg_uninstall()
{
    local name=$1

    eval $name"_uninstall"
    return $?
}

pkg_alwaysinstall()
{
    local name=$1

    eval $name"_alwaysinstall"
    return $?
}

grk_install()
{
    local name
    local installed
    name=$1

    echo "Package Name: $name"
    . ~/.ctafconf/etc/"$name".grk

    if pkg_is_installed $name; then
        installed=no;
    else
        echo -n "Description :"
        pkg_description $name
        echo "--"
        installed=yes

        if pkg_install $name; then
            echo "Package $name installed"
        else
            echo "NOT INSTALLED"
        fi
    fi
    if ! pkg_alwaysinstall $name ; then
        echo "AlwaysInstalled FAILED"
    fi
    if [ x$installed = xyes ]; then
        echo ""
        echo ""
    fi
}

grk_install_list()
{
    list=$@
    for i in $list; do
        grk_install $i
    done
}

grk_installed_list()
{
    ls -1 ~/.ctafconf/etc | grep ".grk$" | while read line; do
        name=`echo $line | sed -e s/.grk//`
        . ~/.ctafconf/etc/"$name".grk
        if pkg_is_installed $name >/dev/null; then
            echo "$name"
        fi
    done
}

#############################################################################
##START
#############################################################################
if ! [ -d ~/.ctafconf/ ] ; then
  echo "Can't find ~/.ctafconf directory"
  echo "Aborting, verify that you have untar the archive into your home directory"
  exit
fi

#. ~/.ctafconf/bin/ct-profile
#install tools
. ~/.ctafconf/etc/shell/grktools.sh
#shellscript frontend
. ~/.ctafconf/etc/shell/ssft.sh


if ! [ -f ~/.ctafconf/perso/user-profile ] ; then
  echo "Can't find ~/.ctafconf/perso/user-profile directory"
  echo "Aborting, execute ct-profile, or relauch install"
  exit
fi
. ~/.ctafconf/perso/user-profile

grk_dir ~/.ctafconf/perso
grk_dir ~/.ctafconf/perso/semantic
grk_dir ~/.ctafconf/perso/ssh
grk_dir ~/.ctafconf/perso/repos
grk_dir ~/.ctafconf/perso/wallpaper
grk_dir ~/.ctafconf/perso/bin
grk_dir ~/.ctafconf/perso/previous


export SSFT_FRONTEND=$ctafconf_interface

SSFT_DEFAULT=`grk_installed_list`
ssft_select_multiple "Install" "Select packages you want to install" `ls -1 ~/.ctafconf/etc | grep ".grk$" | sed -e s/.grk//`

grk_install_list $SSFT_RESULT


# ls -1 ~/.ctafconf/etc | grep ".grk$" | while read line; do
#     name=`echo $line | sed -e s/.grk//`
#     grk_install $name
# done


